<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<!-- Three-screen transaction dialog as StackPane overlay -->
<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:id="transactionDialogOverlay"
           visible="false" managed="false"
           style="-fx-background-color: rgba(0,0,0,0.6);"
           alignment="CENTER">

    <!-- SCREEN 1: Main Add Transaction Dialog -->
    <VBox fx:id="mainDialogScreen" styleClass="card" spacing="16"
          style="-fx-max-width: 480; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 12;">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" style="-fx-padding: 16 20; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0;">
            <Button text="✕" onAction="#closeDialog" 
                    style="-fx-background-color: transparent; -fx-text-fill: #6b7280; -fx-font-size: 20px; -fx-cursor: hand; -fx-padding: 4;"/>
            <Text text="Add a transaction" style="-fx-font-size: 17px; -fx-font-weight: 600;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Save" onAction="#saveTransaction" 
                    style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-background-radius: 6; -fx-padding: 6 16; -fx-cursor: hand; -fx-font-weight: 500;"/>
        </HBox>

        <VBox spacing="16" style="-fx-padding: 16 20 20 20;">
            <!-- Participant Summary -->
            <Text fx:id="participantSummaryText" text="With you and: Select participants" 
                  style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>

            <!-- Description -->
            <VBox spacing="6">
                <Text text="Description" style="-fx-font-size: 13px; -fx-fill: #374151; -fx-font-weight: 500;"/>
                <TextField fx:id="descriptionField" promptText="Enter description" 
                           style="-fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-radius: 6; -fx-background-radius: 6; -fx-padding: 10;"/>
            </VBox>

            <!-- Amount -->
            <VBox spacing="6">
                <Text text="Amount" style="-fx-font-size: 13px; -fx-fill: #374151; -fx-font-weight: 500;"/>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Text text="€" style="-fx-font-size: 16px; -fx-fill: #6b7280; -fx-font-weight: 500;"/>
                    <TextField fx:id="amountField" promptText="0.00" HBox.hgrow="ALWAYS"
                               style="-fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-radius: 6; -fx-background-radius: 6; -fx-padding: 10;"/>
                </HBox>
            </VBox>

            <!-- Payer and Split Mode Chips -->
            <HBox spacing="6" alignment="CENTER_LEFT" style="-fx-padding: 4 0;">
                <Text text="Paid by" style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                <HBox fx:id="payerChip" onMouseClicked="#showPayerScreen" spacing="6" alignment="CENTER"
                      style="-fx-background-color: #eff6ff; -fx-border-color: #3b82f6; -fx-border-width: 1; -fx-border-radius: 16; -fx-background-radius: 16; -fx-padding: 5 12; -fx-cursor: hand;">
                    <Text fx:id="payerChipText" text="select payer" style="-fx-font-size: 13px; -fx-fill: #1e40af; -fx-font-weight: 500;"/>
                </HBox>
                <Text text="and split" style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                <HBox fx:id="splitModeChip" onMouseClicked="#showSplitOptionsScreen" spacing="6" alignment="CENTER"
                      style="-fx-background-color: #eff6ff; -fx-border-color: #3b82f6; -fx-border-width: 1; -fx-border-radius: 16; -fx-background-radius: 16; -fx-padding: 5 12; -fx-cursor: hand;">
                    <Text fx:id="splitModeChipText" text="equally" style="-fx-font-size: 13px; -fx-fill: #1e40af; -fx-font-weight: 500;"/>
                </HBox>
            </HBox>

            <!-- Validation Error -->
            <Text fx:id="validationErrorText" text="" visible="false" managed="false"
                  style="-fx-font-size: 12px; -fx-fill: #ef4444;"/>
        </VBox>
    </VBox>

    <!-- SCREEN 2: Choose Payer -->
    <VBox fx:id="payerScreen" visible="false" managed="false" styleClass="card" spacing="0"
          style="-fx-max-width: 480; -fx-max-height: 600; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 12;">
        
        <!-- Header -->
        <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 16 20; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0;">
            <Button text="← Cancel" onAction="#returnToMainDialog" 
                    style="-fx-background-color: transparent; -fx-text-fill: #3b82f6; -fx-font-size: 14px; -fx-cursor: hand; -fx-padding: 4; -fx-font-weight: 500;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Text text="Choose payer" style="-fx-font-size: 17px; -fx-font-weight: 600;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Region prefWidth="80"/>
        </HBox>

        <!-- Payer list -->
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: white;">
            <VBox fx:id="payerListBox" spacing="0" style="-fx-padding: 8;"/>
        </ScrollPane>
    </VBox>

    <!-- SCREEN 3: Split Options -->
    <VBox fx:id="splitOptionsScreen" visible="false" managed="false" styleClass="card" spacing="0"
          style="-fx-max-width: 480; -fx-max-height: 650; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 12;">
        
        <!-- Header -->
        <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 16 20; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0;">
            <Button text="← Cancel" onAction="#returnToMainDialog" 
                    style="-fx-background-color: transparent; -fx-text-fill: #3b82f6; -fx-font-size: 14px; -fx-cursor: hand; -fx-padding: 4; -fx-font-weight: 500;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Text text="Split options" style="-fx-font-size: 17px; -fx-font-weight: 600;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="Done" onAction="#returnToMainDialog" 
                    style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-background-radius: 6; -fx-padding: 6 16; -fx-cursor: hand; -fx-font-weight: 500;"/>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: white;">
            <VBox spacing="20" style="-fx-padding: 20;">
                <!-- Split Mode Selection -->
                <VBox spacing="12">
                    <RadioButton fx:id="equalSplitRadio" text="Split equally" selected="true"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                    <RadioButton fx:id="percentageSplitRadio" text="Split by percentage"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                    <RadioButton fx:id="customAmountSplitRadio" text="Split by custom amounts"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                </VBox>

                <!-- Equal Split Content -->
                <VBox fx:id="equalSplitContent" spacing="12">
                    <Text text="Select which people owe an equal share." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="equalSplitParticipantsBox" spacing="8"/>
                    <Text fx:id="equalSplitSummary" text="" style="-fx-font-size: 13px; -fx-fill: #374151; -fx-font-weight: 500;"/>
                </VBox>

                <!-- Percentage Split Content -->
                <VBox fx:id="percentageSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter percentage for each person." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="percentageSplitParticipantsBox" spacing="8"/>
                    <Text fx:id="percentageSplitSummary" text="Total: 0%" style="-fx-font-size: 13px; -fx-fill: #6b7280; -fx-font-weight: 500;"/>
                </VBox>

                <!-- Custom Amount Split Content -->
                <VBox fx:id="customAmountSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter custom amount for each person." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="customAmountSplitParticipantsBox" spacing="8"/>
                    <Text fx:id="customAmountSplitSummary" text="Remaining: €0.00" style="-fx-font-size: 13px; -fx-fill: #6b7280; -fx-font-weight: 500;"/>
                </VBox>
            </VBox>
        </ScrollPane>
    </VBox>

</StackPane>
